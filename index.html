<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ë‚˜ë§Œì˜ ì›¹ RPG - í™•ì¥íŒ</title>
    <style>
        body { font-family: 'Malgun Gothic', sans-serif; text-align: center; margin-top: 20px; }
        #game-board { border: 2px solid #333; width: 400px; margin: 0 auto; padding: 20px; border-radius: 10px; background-color: #f9f9f9; }
        .stats { display: flex; justify-content: space-between; font-size: 1.1em; margin-bottom: 10px; font-weight: bold; background: #eee; padding: 10px; border-radius: 5px; }
        #map-display { font-size: 2em; letter-spacing: 5px; margin: 10px 0; background: #e0f7fa; padding: 10px; border-radius: 5px; }
        #log { height: 150px; border: 1px solid #ccc; overflow-y: scroll; padding: 10px; text-align: left; background-color: #fff; margin-bottom: 10px; font-size: 0.9em; }
        button { padding: 8px 15px; font-size: 1em; margin: 3px; cursor: pointer; border-radius: 5px; border: 1px solid #999; }
        .controls { margin-bottom: 10px; }
    </style>
</head>
<body>
    <div id="game-board">
        <h2>ëŒ€ëª¨í—˜ RPG</h2>
        
        <div class="stats">
            <div>Lv: <span id="p-lv">1</span></div>
            <div>HP: <span id="p-hp">100</span>/<span id="p-max-hp">100</span></div>
            <div>EXP: <span id="p-exp">0</span>/<span id="p-max-exp">20</span></div>
        </div>

        <div id="map-display">
            </div>

        <div class="controls" id="move-btns">
            <button onclick="move(0, -1)">ìœ„ë¡œ</button><br>
            <button onclick="move(-1, 0)">ì™¼ìª½</button>
            <button onclick="move(1, 0)">ì˜¤ë¥¸ìª½</button><br>
            <button onclick="move(0, 1)">ì•„ë˜ë¡œ</button>
        </div>

        <div class="controls" id="battle-btns" style="display:none;">
            <p><b>ì  HP: <span id="m-hp">0</span></b></p>
            <button onclick="attack()">ê³µê²©í•˜ê¸°</button>
            <button onclick="run()">ë„ë§ì¹˜ê¸°</button>
        </div>

        <div id="log">ê²Œì„ì„ ì‹œì‘í•©ë‹ˆë‹¤. ë°©í–¥í‚¤ ë²„íŠ¼ìœ¼ë¡œ ì´ë™í•˜ì„¸ìš”!<br></div>
    </div>

    <script>
        // í”Œë ˆì´ì–´ ì •ë³´
        let player = { lv: 1, hp: 100, maxHp: 100, exp: 0, maxExp: 20, x: 0, y: 0 };
        let monster = { hp: 0, maxHp: 0 };
        let inBattle = false;

        // 3x3 ë§µ êµ¬ì¡° (0: í‰ì§€, 1: ë§ˆì„, 2: ìˆ², 3: ë“œë˜ê³¤)
        const mapData = [
            [1, 0, 2],
            [0, 2, 2],
            [2, 2, 3] 
        ];
        
        // ë§µì— ì“°ì¼ ì´ëª¨í‹°ì½˜
        const mapSymbols = { 0: 'ğŸŸ©', 1: 'ğŸ°', 2: 'ğŸŒ²', 3: 'ğŸ‰' };

        // í™”ë©´ ê°±ì‹  í•¨ìˆ˜
        function updateScreen() {
            document.getElementById('p-lv').innerText = player.lv;
            document.getElementById('p-hp').innerText = player.hp;
            document.getElementById('p-max-hp').innerText = player.maxHp;
            document.getElementById('p-exp').innerText = player.exp;
            document.getElementById('p-max-exp').innerText = player.maxExp;
            drawMap();
        }

        // ë§µ ê·¸ë¦¬ê¸° í•¨ìˆ˜
        function drawMap() {
            let mapHtml = "";
            for (let y = 0; y < 3; y++) {
                for (let x = 0; x < 3; x++) {
                    if (player.x === x && player.y === y) {
                        mapHtml += 'ğŸ§‘'; // í”Œë ˆì´ì–´ í˜„ì¬ ìœ„ì¹˜
                    } else {
                        mapHtml += mapSymbols[mapData[y][x]];
                    }
                }
                mapHtml += "<br>";
            }
            document.getElementById('map-display').innerHTML = mapHtml;
        }

        function addLog(text) {
            let logDiv = document.getElementById('log');
            logDiv.innerHTML += text + "<br>";
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        // ì´ë™ í•¨ìˆ˜
        function move(dx, dy) {
            if (inBattle) return; // ì „íˆ¬ ì¤‘ì—” ì´ë™ ë¶ˆê°€

            let nx = player.x + dx;
            let ny = player.y + dy;

            // ë§µ ë°–ìœ¼ë¡œ ë²—ì–´ë‚˜ëŠ”ì§€ í™•ì¸
            if (nx < 0 || nx > 2 || ny < 0 || ny > 2) {
                addLog("ê·¸ìª½ìœ¼ë¡œëŠ” ê°ˆ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
                return;
            }

            player.x = nx;
            player.y = ny;
            addLog("ì´ë™í–ˆìŠµë‹ˆë‹¤.");
            updateScreen();
            checkEvent(); // ì´ë™í•œ ì¹¸ì— ë¬´ì—‡ì´ ìˆëŠ”ì§€ í™•ì¸
        }

        // íƒ€ì¼ ì´ë²¤íŠ¸ í™•ì¸ í•¨ìˆ˜
        function checkEvent() {
            let tile = mapData[player.y][player.x];
            if (tile === 1) {
                addLog("ë§ˆì„ì— ë„ì°©í–ˆìŠµë‹ˆë‹¤. HPê°€ ëª¨ë‘ íšŒë³µë©ë‹ˆë‹¤! ğŸ›ï¸");
                player.hp = player.maxHp;
                updateScreen();
            } else if (tile === 2) {
                if (Math.random() < 0.5) { // 50% í™•ë¥ ë¡œ ëª¬ìŠ¤í„° ì¡°ìš°
                    startBattle(50, "ìŠ¬ë¼ì„");
                } else {
                    addLog("í‰í™”ë¡œìš´ ìˆ²ì…ë‹ˆë‹¤.");
                }
            } else if (tile === 3) {
                startBattle(150, "ë“œë˜ê³¤");
            }
        }

        // ì „íˆ¬ ì‹œì‘
        function startBattle(hp, name) {
            inBattle = true;
            monster.hp = hp;
            document.getElementById('move-btns').style.display = 'none';
            document.getElementById('battle-btns').style.display = 'block';
            document.getElementById('m-hp').innerText = monster.hp;
            addLog(`ì•—! ì•¼ìƒì˜ <b>${name}</b>(ì´)ê°€ ë‚˜íƒ€ë‚¬ë‹¤! âš”ï¸`);
        }

        // ê³µê²©
        function attack() {
            // ë ˆë²¨ì´ ì˜¤ë¥¼ìˆ˜ë¡ ë°ë¯¸ì§€ê°€ ê°•í•´ì§‘ë‹ˆë‹¤
            let dmg = Math.floor(Math.random() * 10) + 5 + (player.lv * 2);
            monster.hp -= dmg;
            if (monster.hp < 0) monster.hp = 0;
            document.getElementById('m-hp').innerText = monster.hp;
            addLog(`ëª¬ìŠ¤í„°ì—ê²Œ ${dmg}ì˜ í”¼í•´ë¥¼ ì…í˜”ìŠµë‹ˆë‹¤!`);

            if (monster.hp === 0) {
                winBattle();
                return;
            }

            // ëª¬ìŠ¤í„° ë°˜ê²©
            let mDmg = Math.floor(Math.random() * 8) + 3;
            player.hp -= mDmg;
            if (player.hp < 0) player.hp = 0;
            addLog(`ëª¬ìŠ¤í„°ì˜ ê³µê²©! ${mDmg}ì˜ í”¼í•´ë¥¼ ì…ì—ˆìŠµë‹ˆë‹¤.`);
            updateScreen();

            if (player.hp === 0) {
                addLog("<b style='color:red;'>ê²Œì„ ì˜¤ë²„... ìƒˆë¡œê³ ì¹¨í•˜ì—¬ ë‹¤ì‹œ ì‹œì‘í•˜ì„¸ìš”.</b>");
                document.getElementById('battle-btns').style.display = 'none';
            }
        }

        // ë„ë§ì¹˜ê¸°
        function run() {
            addLog("ë¬´ì‚¬íˆ ë„ë§ì³¤ìŠµë‹ˆë‹¤! ğŸƒ");
            endBattle();
        }

        // ì „íˆ¬ ìŠ¹ë¦¬ ë° ë ˆë²¨ì—… ì²˜ë¦¬
        function winBattle() {
            addLog("<b>ì „íˆ¬ ìŠ¹ë¦¬!</b> ê²½í—˜ì¹˜ë¥¼ 10 ì–»ì—ˆìŠµë‹ˆë‹¤.");
            player.exp += 10;
            
            if (player.exp >= player.maxExp) {
                player.lv += 1;
                player.exp -= player.maxExp;
                player.maxExp += 10; // ë‹¤ìŒ ë ˆë²¨ì—…ì— í•„ìš”í•œ ê²½í—˜ì¹˜ ì¦ê°€
                player.maxHp += 20;  // ìµœëŒ€ ì²´ë ¥ ì¦ê°€
                player.hp = player.maxHp;
                addLog(`ğŸ‰ <b>ë ˆë²¨ì—…! Lv.${player.lv}ì´ ë˜ì—ˆìŠµë‹ˆë‹¤!</b> ìµœëŒ€ ì²´ë ¥ì´ ì˜¤ë¥´ê³  ëª¨ë‘ íšŒë³µë©ë‹ˆë‹¤.`);
            }
            
            endBattle();
            updateScreen();
        }

        // ì „íˆ¬ ì¢…ë£Œ
        function endBattle() {
            inBattle = false;
            document.getElementById('move-btns').style.display = 'block'; // ì´ë™ ë²„íŠ¼ ë‹¤ì‹œ í‘œì‹œ
            document.getElementById('battle-btns').style.display = 'none'; // ì „íˆ¬ ë²„íŠ¼ ìˆ¨ê¹€
        }

        updateScreen(); // ì²˜ìŒ ì‹œì‘í•  ë•Œ í™”ë©´ í•œë²ˆ ê·¸ë ¤ì£¼ê¸°
    </script>
</body>
</html>
