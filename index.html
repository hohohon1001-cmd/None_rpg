<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ë‚˜ë§Œì˜ ì›¹ RPG - ì™„ì„±í˜•</title>
    <style>
        body { font-family: 'Malgun Gothic', sans-serif; text-align: center; margin-top: 10px; background-color: #222; color: #333; }
        #game-board { display: flex; flex-direction: column; width: 600px; margin: 0 auto; padding: 15px; border-radius: 10px; background-color: #f4f4f9; box-shadow: 0 0 15px rgba(0,0,0,0.5); }
        .panel-row { display: flex; justify-content: space-between; margin-bottom: 10px; }
        .panel { background: #fff; padding: 10px; border-radius: 8px; border: 1px solid #ddd; width: 48%; box-sizing: border-box; }
        
        /* ìƒíƒœì°½ & ì¸ë²¤í† ë¦¬ */
        .stats { font-size: 0.9em; font-weight: bold; text-align: left; line-height: 1.6; }
        .inventory { font-size: 0.9em; text-align: left; background: #e8f5e9; }
        
        /* ë§µ & ë‚˜ì¹¨ë°˜ */
        #map-display { font-size: 1.5em; letter-spacing: 2px; margin: 10px 0; background: #e0f7fa; padding: 10px; border-radius: 5px; text-align: center; }
        #compass { font-size: 0.9em; background: #fff9c4; padding: 5px; border-radius: 5px; margin-bottom: 10px; }
        
        /* ë¡œê·¸ & ë²„íŠ¼ */
        #log { height: 120px; border: 1px solid #ccc; overflow-y: scroll; padding: 10px; text-align: left; background-color: #fff; font-size: 0.85em; margin-bottom: 10px; }
        button { padding: 6px 12px; font-size: 0.9em; margin: 2px; cursor: pointer; border-radius: 5px; border: 1px solid #999; background: #fff; transition: 0.2s; }
        button:hover { background: #eee; }
        .btn-action { background: #ffcc80; font-weight: bold; border-color: #f57c00; }
        .btn-system { background: #cfd8dc; }
    </style>
</head>
<body>
    <div id="game-board">
        <h2>ì „ì„¤ì˜ ìš©ì‚¬ RPG</h2>
        
        <div class="panel-row">
            <div class="panel stats">
                <div>ğŸ‘‘ Lv: <span id="p-lv">1</span> (EXP: <span id="p-exp">0</span>/<span id="p-max-exp">20</span>)</div>
                <div>â¤ï¸ HP: <span id="p-hp">100</span> / <span id="p-max-hp">100</span></div>
                <div>âš”ï¸ ê³µê²©ë ¥: <span id="p-atk">10</span> (+<span id="p-wlv">0</span>ê°•í™”)</div>
                <div>ğŸ’° ê³¨ë“œ: <span id="p-gold">0</span> G</div>
            </div>
            <div class="panel inventory">
                <b>ğŸ’ ì¸ë²¤í† ë¦¬</b><br>
                ğŸ§ª í¬ì…˜: <span id="inv-potion">0</span>ê°œ 
                <button onclick="usePotion()">ì‚¬ìš©</button><br>
                ğŸ’ ê°•í™”ì„: <span id="inv-stone">0</span>ê°œ<br>
                <button class="btn-action" onclick="enhance()">ëŒ€ì¥ê°„: ë¬´ê¸° ê°•í™”(50G+ì„1)</button>
            </div>
        </div>

        <div class="panel-row">
            <div class="panel" style="width: 100%;">
                <div id="compass">ğŸ§­ ë‚˜ì¹¨ë°˜ (ì£¼ë³€ íƒìƒ‰) - ë¶:? ë™:? ë‚¨:? ì„œ:?</div>
                <div id="map-display"></div>
                
                <div id="move-btns">
                    <button onclick="move(0, -1)">â¬†ï¸ ë¶ìª½</button><br>
                    <button onclick="move(-1, 0)">â¬…ï¸ ì„œìª½</button>
                    <button onclick="move(1, 0)">â¡ï¸ ë™ìª½</button><br>
                    <button onclick="move(0, 1)">â¬‡ï¸ ë‚¨ìª½</button>
                </div>

                <div id="battle-btns" style="display:none; background: #ffebee; padding: 10px; border-radius: 5px;">
                    <p style="color:red; font-weight:bold;">ğŸ˜ˆ ì  HP: <span id="m-hp">0</span></p>
                    <button class="btn-action" onclick="attack()">âš”ï¸ ê³µê²©í•˜ê¸°</button>
                    <button onclick="run()">ğŸƒ ë„ë§ì¹˜ê¸°</button>
                </div>
            </div>
        </div>

        <div id="log">ìƒˆë¡œìš´ ëª¨í—˜ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤!<br></div>
        <div>
            <button class="btn-system" onclick="saveGame()">ğŸ’¾ ê²Œì„ ì €ì¥í•˜ê¸°</button>
            <button class="btn-system" onclick="loadGame()">ğŸ“‚ ë¶ˆëŸ¬ì˜¤ê¸°</button>
        </div>
    </div>

    <script>
        // --- 1. ë°ì´í„° ì„¤ì • ---
        let player = { lv: 1, hp: 100, maxHp: 100, exp: 0, maxExp: 20, atk: 10, weaponLv: 0, gold: 0, x: 0, y: 0 };
        let inventory = { potion: 3, stone: 0 }; // ê¸°ë³¸ ì§€ê¸‰ ì•„ì´í…œ
        let monster = { hp: 0, maxHp: 0, atk: 0, name: "" };
        let inBattle = false;

        // 5x5 í™•ì¥ ë§µ (1:ë§ˆì„, 0:í‰ì•¼, 2:ìˆ², 3:ë°”ìœ„ì‚°, 4:ë³´ìŠ¤)
        const mapData = [
            [1, 0, 0, 2, 2],
            [0, 0, 2, 2, 3],
            [0, 2, 2, 3, 3],
            [2, 2, 3, 3, 4],
            [2, 3, 3, 4, 4]
        ];
        const mapSymbols = { 0: 'ğŸŸ©', 1: 'ğŸ°', 2: 'ğŸŒ²', 3: 'â›°ï¸', 4: 'ğŸŒ‹' };
        const mapNames = { 0: 'í‰ì•¼', 1: 'ë§ˆì„', 2: 'ìˆ²', 3: 'ë°”ìœ„ì‚°', 4: 'í™”ì‚°' };

        // --- 2. ì‹œìŠ¤í…œ í•¨ìˆ˜ ---
        function updateScreen() {
            document.getElementById('p-lv').innerText = player.lv;
            document.getElementById('p-hp').innerText = player.hp;
            document.getElementById('p-max-hp').innerText = player.maxHp;
            document.getElementById('p-exp').innerText = player.exp;
            document.getElementById('p-max-exp').innerText = player.maxExp;
            document.getElementById('p-atk').innerText = player.atk + (player.weaponLv * 5);
            document.getElementById('p-wlv').innerText = player.weaponLv;
            document.getElementById('p-gold').innerText = player.gold;
            
            document.getElementById('inv-potion').innerText = inventory.potion;
            document.getElementById('inv-stone').innerText = inventory.stone;
            
            drawMap();
            updateCompass();
        }

        function addLog(text) {
            let logDiv = document.getElementById('log');
            logDiv.innerHTML += text + "<br>";
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function saveGame() {
            let saveData = { p: player, i: inventory };
            localStorage.setItem('myRpgSaveData', JSON.stringify(saveData));
            addLog("<b>ğŸ’¾ ê²Œì„ì´ ì•ˆì „í•˜ê²Œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!</b>");
        }

        function loadGame() {
            let saved = localStorage.getItem('myRpgSaveData');
            if(saved) {
                let data = JSON.parse(saved);
                player = data.p; inventory = data.i;
                addLog("<b>ğŸ“‚ ì €ì¥ëœ ëª¨í—˜ì„ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.</b>");
                inBattle = false;
                document.getElementById('move-btns').style.display = 'block';
                document.getElementById('battle-btns').style.display = 'none';
                updateScreen();
            } else {
                addLog("ì €ì¥ëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.");
            }
        }

        // --- 3. ë§µ & ë‚˜ì¹¨ë°˜ í•¨ìˆ˜ ---
        function drawMap() {
            let mapHtml = "";
            for (let y = 0; y < 5; y++) {
                for (let x = 0; x < 5; x++) {
                    if (player.x === x && player.y === y) mapHtml += 'ğŸ§‘';
                    else mapHtml += mapSymbols[mapData[y][x]];
                }
                mapHtml += "<br>";
            }
            document.getElementById('map-display').innerHTML = mapHtml;
        }

        function updateCompass() {
            let n = (player.y > 0) ? mapNames[mapData[player.y-1][player.x]] : "ë²½";
            let s = (player.y < 4) ? mapNames[mapData[player.y+1][player.x]] : "ë²½";
            let w = (player.x > 0) ? mapNames[mapData[player.y][player.x-1]] : "ë²½";
            let e = (player.x < 4) ? mapNames[mapData[player.y][player.x+1]] : "ë²½";
            document.getElementById('compass').innerText = `ğŸ§­ ë‚˜ì¹¨ë°˜ - ë¶:[${n}] ë™:[${e}] ë‚¨:[${s}] ì„œ:[${w}]`;
        }

        function move(dx, dy) {
            if (inBattle) return;
            let nx = player.x + dx, ny = player.y + dy;
            if (nx < 0 || nx > 4 || ny < 0 || ny > 4) {
                addLog("ê·¸ìª½ìœ¼ë¡œëŠ” ê°ˆ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."); return;
            }
            player.x = nx; player.y = ny;
            updateScreen();
            checkEvent();
        }

        function checkEvent() {
            let tile = mapData[player.y][player.x];
            if (tile === 1) {
                addLog("ğŸ° <b>ë§ˆì„</b>ì— ë„ì°©í–ˆìŠµë‹ˆë‹¤. ì²´ë ¥ì´ ëª¨ë‘ íšŒë³µë©ë‹ˆë‹¤!");
                player.hp = player.maxHp;
                updateScreen();
            } else if (tile === 2 && Math.random() < 0.6) {
                startBattle(40, 5, "ê³ ë¸”ë¦°");
            } else if (tile === 3 && Math.random() < 0.7) {
                startBattle(80, 12, "ë°”ìœ„ ê³¨ë ˜");
            } else if (tile === 4) {
                startBattle(300, 25, "í™”ì‚° ë“œë˜ê³¤");
            } else {
                addLog("ì¡°ìš©íˆ ê¸¸ì„ ì§€ë‚˜ê°‘ë‹ˆë‹¤.");
            }
        }

        // --- 4. ì¸ë²¤í† ë¦¬ & ê°•í™” ---
        function usePotion() {
            if(inventory.potion > 0) {
                inventory.potion--;
                player.hp += 50;
                if(player.hp > player.maxHp) player.hp = player.maxHp;
                addLog("ğŸ§ª í¬ì…˜ì„ ë§ˆì…” ì²´ë ¥ì„ 50 íšŒë³µí–ˆìŠµë‹ˆë‹¤!");
                updateScreen();
            } else {
                addLog("í¬ì…˜ì´ ì—†ìŠµë‹ˆë‹¤!");
            }
        }

        function enhance() {
            if (player.x !== 0 || player.y !== 0) {
                addLog("ê°•í™”ëŠ” ë§ˆì„(ğŸ°)ì—ì„œë§Œ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤!"); return;
            }
            if(player.gold >= 50 && inventory.stone >= 1) {
                player.gold -= 50;
                inventory.stone -= 1;
                player.weaponLv++;
                addLog(`âœ¨ <b>ê°•í™” ì„±ê³µ!</b> ë¬´ê¸°ê°€ +${player.weaponLv}ê°•ì´ ë˜ì—ˆìŠµë‹ˆë‹¤! (ê³µê²©ë ¥ +5)`);
                updateScreen();
            } else {
                addLog("ê°•í™” ë¹„ìš©(50G)ì´ë‚˜ ê°•í™”ì„(1ê°œ)ì´ ë¶€ì¡±í•©ë‹ˆë‹¤.");
            }
        }

        // --- 5. ì „íˆ¬ & ë¶€í™œ ---
        function startBattle(hp, atk, name) {
            inBattle = true;
            monster.hp = hp; monster.atk = atk; monster.name = name;
            document.getElementById('move-btns').style.display = 'none';
            document.getElementById('battle-btns').style.display = 'block';
            document.getElementById('m-hp').innerText = monster.hp;
            addLog(`âš ï¸ ì•¼ìƒì˜ <b>${name}</b>(ì´)ê°€ ë‚˜íƒ€ë‚¬ë‹¤!`);
        }

        function attack() {
            let totalAtk = player.atk + (player.weaponLv * 5);
            let dmg = Math.floor(Math.random() * 5) + totalAtk;
            monster.hp -= dmg;
            if (monster.hp < 0) monster.hp = 0;
            document.getElementById('m-hp').innerText = monster.hp;
            addLog(`âš”ï¸ ${monster.name}ì—ê²Œ ${dmg}ì˜ í”¼í•´!`);

            if (monster.hp === 0) { winBattle(); return; }

            // ëª¬ìŠ¤í„° ë°˜ê²©
            let mDmg = Math.floor(Math.random() * 5) + monster.atk;
            player.hp -= mDmg;
            if (player.hp < 0) player.hp = 0;
            addLog(`ğŸ’¥ ${monster.name}ì˜ ë°˜ê²©! ${mDmg}ì˜ í”¼í•´ë¥¼ ì…ì—ˆìŠµë‹ˆë‹¤.`);
            updateScreen();

            if (player.hp === 0) die();
        }

        function run() { addLog("ë¬´ì‚¬íˆ ë„ë§ì³¤ìŠµë‹ˆë‹¤! ğŸƒ"); endBattle(); }

        function winBattle() {
            let gainExp = 15; let gainGold = Math.floor(Math.random() * 20) + 10;
            player.exp += gainExp; player.gold += gainGold;
            addLog(`ğŸ† <b>ì „íˆ¬ ìŠ¹ë¦¬!</b> ${gainExp} EXPì™€ ${gainGold} Gë¥¼ ì–»ì—ˆìŠµë‹ˆë‹¤.`);
            
            // ì•„ì´í…œ ë“œë¡­ í™•ë¥ 
            if(Math.random() < 0.3) { inventory.potion++; addLog("ğŸ ì „ë¦¬í’ˆìœ¼ë¡œ <b>í¬ì…˜</b>ì„ ì–»ì—ˆìŠµë‹ˆë‹¤!"); }
            if(Math.random() < 0.2) { inventory.stone++; addLog("ğŸ ì „ë¦¬í’ˆìœ¼ë¡œ <b>ê°•í™”ì„</b>ì„ ì–»ì—ˆìŠµë‹ˆë‹¤!"); }

            if (player.exp >= player.maxExp) {
                player.lv++; player.exp -= player.maxExp;
                player.maxExp += 15; player.maxHp += 20; player.atk += 3;
                player.hp = player.maxHp;
                addLog(`ğŸ‰ <b>ë ˆë²¨ì—…! Lv.${player.lv}</b>ì´ ë˜ì—ˆìŠµë‹ˆë‹¤!`);
            }
            endBattle(); updateScreen();
        }

        function die() {
            addLog("<b style='color:red;'>ğŸ’€ ëˆˆì•ì´ ê¹œê¹œí•´ì¡Œë‹¤... (ê°€ì§„ ê³¨ë“œì˜ ì ˆë°˜ì„ ìƒê³  ë§ˆì„ë¡œ ê·€í™˜í•©ë‹ˆë‹¤.)</b>");
            player.gold = Math.floor(player.gold / 2);
            player.hp = player.maxHp;
            player.x = 0; player.y = 0; // ë§ˆì„ ì¢Œí‘œë¡œ ì´ë™
            endBattle(); updateScreen();
        }

        function endBattle() {
            inBattle = false;
            document.getElementById('move-btns').style.display = 'block';
            document.getElementById('battle-btns').style.display = 'none';
        }

        updateScreen();
    </script>
</body>
</html>

