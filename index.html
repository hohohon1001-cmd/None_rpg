<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ë‚˜ë§Œì˜ ì›¹ RPG - ë¬´í•œ íƒí—˜</title>
    <style>
        body { font-family: 'Malgun Gothic', sans-serif; text-align: center; background-color: #222; color: #333; margin: 0; padding: 20px; }
        #start-screen { background: #fff; padding: 50px; border-radius: 10px; width: 300px; margin: 50px auto; box-shadow: 0 0 20px rgba(0,0,0,0.5); }
        #game-board { display: none; flex-direction: column; width: 600px; margin: 0 auto; padding: 15px; border-radius: 10px; background-color: #f4f4f9; box-shadow: 0 0 15px rgba(0,0,0,0.5); }
        
        .panel-row { display: flex; justify-content: space-between; margin-bottom: 10px; }
        .panel { background: #fff; padding: 10px; border-radius: 8px; border: 1px solid #ddd; width: 48%; box-sizing: border-box; }
        .stats { font-size: 0.9em; font-weight: bold; text-align: left; line-height: 1.6; }
        
        #map-display { font-size: 1.5em; letter-spacing: 2px; margin: 10px 0; background: #e0f7fa; padding: 10px; border-radius: 5px; text-align: center; line-height: 1.2; }
        #log { height: 120px; border: 1px solid #ccc; overflow-y: scroll; padding: 10px; text-align: left; background-color: #fff; font-size: 0.85em; margin-bottom: 10px; }
        
        button { padding: 6px 12px; font-size: 0.9em; margin: 2px; cursor: pointer; border-radius: 5px; border: 1px solid #999; background: #fff; transition: 0.2s; }
        button:hover { background: #eee; }
        .btn-action { background: #ffcc80; font-weight: bold; border-color: #f57c00; }
        .btn-skill { background: #81d4fa; font-weight: bold; border-color: #0288d1; }
        
        input { padding: 8px; font-size: 1em; width: 80%; margin-bottom: 10px; text-align: center; }
    </style>
</head>
<body>

    <div id="start-screen">
        <h2>ì „ì„¤ì˜ ì‹œì‘</h2>
        <p>ìš©ì‚¬ì˜ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”.</p>
        <input type="text" id="hero-name" placeholder="ì´ë¦„ ì…ë ¥" onkeypress="if(event.keyCode==13) startGame()">
        <br>
        <button class="btn-action" onclick="startGame()">ëª¨í—˜ ì‹œì‘í•˜ê¸°</button>
    </div>

    <div id="game-board">
        <h2 id="display-name">ìš©ì‚¬ RPG</h2>
        
        <div class="panel-row">
            <div class="panel stats" style="width: 100%; display: flex; justify-content: space-around;">
                <div>ğŸ‘‘ Lv: <span id="p-lv">1</span> (<span id="p-exp">0</span>/<span id="p-max-exp">20</span>)</div>
                <div>â¤ï¸ HP: <span id="p-hp">100</span>/<span id="p-max-hp">100</span></div>
                <div>ğŸ’§ MP: <span id="p-mp">30</span>/<span id="p-max-mp">30</span></div>
                <div>âš”ï¸ ê³µê²©ë ¥: <span id="p-atk">10</span></div>
                <div>ğŸ’° ê³¨ë“œ: <span id="p-gold">0</span>G</div>
            </div>
        </div>

        <div class="panel-row">
            <div class="panel" style="width: 100%;">
                <div style="font-size: 0.8em; color: #666;">(ì§€ë„ ëìœ¼ë¡œ ì´ë™í•˜ë©´ ìƒˆë¡œìš´ êµ¬ì—­ì´ ìƒì„±ë©ë‹ˆë‹¤)</div>
                <div id="map-display"></div>
                
                <div id="move-btns">
                    <button onclick="move(0, -1)">â¬†ï¸ ë¶ìª½</button><br>
                    <button onclick="move(-1, 0)">â¬…ï¸ ì„œìª½</button>
                    <button onclick="move(1, 0)">â¡ï¸ ë™ìª½</button><br>
                    <button onclick="move(0, 1)">â¬‡ï¸ ë‚¨ìª½</button>
                </div>

                <div id="battle-btns" style="display:none; background: #ffebee; padding: 10px; border-radius: 5px;">
                    <p style="color:red; font-weight:bold;">ğŸ˜ˆ <span id="m-name">ì </span> HP: <span id="m-hp">0</span></p>
                    <button class="btn-action" onclick="attack(false)">âš”ï¸ ì¼ë°˜ ê³µê²©</button>
                    <button class="btn-skill" onclick="attack(true)">ğŸ”¥ íŒŒì´ì–´ë³¼ (MP 10)</button>
                    <button onclick="run()">ğŸƒ ë„ë§ì¹˜ê¸°</button>
                </div>
            </div>
        </div>

        <div id="log"></div>
    </div>

    <script>
        // --- 1. ë°ì´í„° ì„¤ì • ---
        let player = { name: "ìš©ì‚¬", lv: 1, hp: 100, maxHp: 100, mp: 30, maxMp: 30, exp: 0, maxExp: 20, atk: 10, gold: 0, x: 2, y: 2 };
        let monster = { hp: 0, maxHp: 0, atk: 0, name: "" };
        let inBattle = false;
        let mapData = [];

        const mapSymbols = { 0: 'ğŸŸ©', 1: 'ğŸ°', 2: 'ğŸŒ²', 3: 'â›°ï¸' };

        // --- 2. ê²Œì„ ì‹œì‘ & ë§µ ìƒì„± (ë¬´í•œ ì²­í¬ ì‹œìŠ¤í…œ) ---
        function startGame() {
            let nameInput = document.getElementById('hero-name').value;
            if(nameInput.trim() !== "") player.name = nameInput;
            
            document.getElementById('start-screen').style.display = 'none';
            document.getElementById('game-board').style.display = 'flex';
            document.getElementById('display-name').innerText = `[${player.name}]ì˜ ëì—†ëŠ” ëª¨í—˜`;
            
            generateChunk(); // ì²« ë§µ ìƒì„±
            addLog(`<b>${player.name}</b>ë‹˜ì˜ ëª¨í—˜ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤!`);
            updateScreen();
        }

        // 5x5 ì§€ë„ë¥¼ ë¬´ì‘ìœ„ë¡œ ìƒì„±í•˜ëŠ” í•¨ìˆ˜
        function generateChunk() {
            mapData = [];
            for(let y=0; y<5; y++) {
                let row = [];
                for(let x=0; x<5; x++) {
                    let rand = Math.random();
                    if(rand < 0.6) row.push(0); // 60% í‰ì•¼
                    else if(rand < 0.8) row.push(2); // 20% ìˆ²
                    else if(rand < 0.95) row.push(3); // 15% ë°”ìœ„ì‚°
                    else row.push(1); // 5% ë§ˆì„
                }
                mapData.push(row);
            }
            // í”Œë ˆì´ì–´ê°€ ì„œ ìˆëŠ” ê³³ì€ ë¬´ì¡°ê±´ í‰ì•¼ë¡œ
            mapData[player.y][player.x] = 0;
            addLog("ğŸ—ºï¸ <b>ìƒˆë¡œìš´ ì§€ì—­ì— ì§„ì…í–ˆìŠµë‹ˆë‹¤!</b>");
        }

        function drawMap() {
            let mapHtml = "";
            for (let y = 0; y < 5; y++) {
                for (let x = 0; x < 5; x++) {
                    if (player.x === x && player.y === y) mapHtml += 'ğŸ§‘';
                    else mapHtml += mapSymbols[mapData[y][x]];
                }
                mapHtml += "<br>";
            }
            document.getElementById('map-display').innerHTML = mapHtml;
        }

        function updateScreen() {
            document.getElementById('p-lv').innerText = player.lv;
            document.getElementById('p-hp').innerText = player.hp;
            document.getElementById('p-max-hp').innerText = player.maxHp;
            document.getElementById('p-mp').innerText = player.mp;
            document.getElementById('p-max-mp').innerText = player.maxMp;
            document.getElementById('p-exp').innerText = player.exp;
            document.getElementById('p-max-exp').innerText = player.maxExp;
            document.getElementById('p-atk').innerText = player.atk;
            document.getElementById('p-gold').innerText = player.gold;
            drawMap();
        }

        function addLog(text) {
            let logDiv = document.getElementById('log');
            logDiv.innerHTML += text + "<br>";
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        // --- 3. ë¬´í•œ ì´ë™ ì‹œìŠ¤í…œ ---
        function move(dx, dy) {
            if (inBattle) return;
            let nx = player.x + dx, ny = player.y + dy;
            
            // ì§€ë„ ëì„ ë„˜ì–´ê°€ë©´ ìƒˆë¡œìš´ ì²­í¬(ë§µ) ìƒì„±
            if (nx < 0) { player.x = 4; generateChunk(); }
            else if (nx > 4) { player.x = 0; generateChunk(); }
            else if (ny < 0) { player.y = 4; generateChunk(); }
            else if (ny > 4) { player.y = 0; generateChunk(); }
            else { player.x = nx; player.y = ny; }
            
            updateScreen();
            checkEvent();
        }

        function checkEvent() {
            let tile = mapData[player.y][player.x];
            if (tile === 1) {
                addLog("ğŸ° <b>ë§ˆì„</b>ì…ë‹ˆë‹¤! HPì™€ MPê°€ ëª¨ë‘ íšŒë³µë˜ì—ˆìŠµë‹ˆë‹¤.");
                player.hp = player.maxHp;
                player.mp = player.maxMp;
                updateScreen();
            } else if (tile === 2 && Math.random() < 0.4) {
                startBattle(40, 5, "ìˆ² ëŠ‘ëŒ€");
            } else if (tile === 3 && Math.random() < 0.5) {
                startBattle(80, 12, "ë°”ìœ„ ê³¨ë ˜");
            }
        }

        // --- 4. ì „íˆ¬ & ìŠ¤í‚¬ ì‹œìŠ¤í…œ ---
        function startBattle(hp, atk, name) {
            inBattle = true;
            monster.hp = hp; monster.atk = atk; monster.name = name;
            document.getElementById('move-btns').style.display = 'none';
            document.getElementById('battle-btns').style.display = 'block';
            document.getElementById('m-name').innerText = monster.name;
            document.getElementById('m-hp').innerText = monster.hp;
            addLog(`âš ï¸ ì•¼ìƒì˜ <b>${name}</b>(ì´)ê°€ ë‚˜íƒ€ë‚¬ë‹¤!`);
        }

        // isSkillì´ trueë©´ ë§ˆë‚˜ë¥¼ ì†Œëª¨í•˜ê³  ê°•í•œ ê³µê²©
        function attack(isSkill) {
            let dmg = 0;
            if(isSkill) {
                if(player.mp < 10) {
                    addLog("ğŸ’§ ë§ˆë‚˜ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤!"); return;
                }
                player.mp -= 10;
                dmg = Math.floor(Math.random() * 10) + (player.atk * 3); // 3ë°° ë°ë¯¸ì§€
                addLog(`ğŸ”¥ <b>íŒŒì´ì–´ë³¼!</b> ${monster.name}ì—ê²Œ ${dmg}ì˜ ì—„ì²­ë‚œ í”¼í•´!`);
            } else {
                dmg = Math.floor(Math.random() * 5) + player.atk;
                addLog(`âš”ï¸ ì¼ë°˜ ê³µê²©! ${monster.name}ì—ê²Œ ${dmg}ì˜ í”¼í•´!`);
            }

            monster.hp -= dmg;
            if (monster.hp < 0) monster.hp = 0;
            document.getElementById('m-hp').innerText = monster.hp;

            if (monster.hp === 0) { winBattle(); return; }

            // ëª¬ìŠ¤í„° ë°˜ê²©
            let mDmg = Math.floor(Math.random() * 5) + monster.atk;
            player.hp -= mDmg;
            if (player.hp < 0) player.hp = 0;
            addLog(`ğŸ’¥ ${monster.name}ì˜ ë°˜ê²©! ${mDmg}ì˜ í”¼í•´ë¥¼ ì…ì—ˆìŠµë‹ˆë‹¤.`);
            updateScreen();

            if (player.hp === 0) die();
        }

        function run() { addLog("ë¬´ì‚¬íˆ ë„ë§ì³¤ìŠµë‹ˆë‹¤! ğŸƒ"); endBattle(); }

        function winBattle() {
            let gainExp = 15; let gainGold = Math.floor(Math.random() * 20) + 10;
            player.exp += gainExp; player.gold += gainGold;
            addLog(`ğŸ† <b>ìŠ¹ë¦¬!</b> ${gainExp} EXPì™€ ${gainGold} G íšë“!`);
            
            if (player.exp >= player.maxExp) {
                player.lv++; player.exp -= player.maxExp;
                player.maxExp += 15; player.maxHp += 20; player.maxMp += 10; player.atk += 3;
                player.hp = player.maxHp; player.mp = player.maxMp;
                addLog(`ğŸ‰ <b>ë ˆë²¨ì—…! Lv.${player.lv}</b>ì´ ë˜ì—ˆìŠµë‹ˆë‹¤!`);
            }
            endBattle(); updateScreen();
        }

        function die() {
            addLog("<b style='color:red;'>ğŸ’€ ëˆˆì•ì´ ê¹œê¹œí•´ì¡Œë‹¤... (ë§ˆì„ì—ì„œ ë¶€í™œí•©ë‹ˆë‹¤.)</b>");
            player.hp = player.maxHp; player.mp = player.maxMp;
            mapData[player.y][player.x] = 1; // ì£½ì€ ìë¦¬ë¥¼ ë§ˆì„ë¡œ ë°”ê¿”ë²„ë¦¼ (ì„ì‹œ ë¶€í™œì²˜)
            endBattle(); updateScreen();
        }

        function endBattle() {
            inBattle = false;
            document.getElementById('move-btns').style.display = 'block';
            document.getElementById('battle-btns').style.display = 'none';
        }

    </script>
</body>
</html>

